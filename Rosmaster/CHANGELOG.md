# SDK

ROS小车通用扩展板底层STM32固件程序。

## V1.1
1.在原rosmaster基础上，新增carbot车型

## V3.3

1.IMU更换为ICM20948, 增加FUNC_REPORT_ICM_RAW=0x0E功能位，区分原始数据标志位。  
2.修复测试模式的相关内容，修改IMU初始化完成后才运行程序，大约10秒。  
3.增加开机初始化时，自动选择MPU9250或ICM20948。  
4.增加默认旭日派小车的配置开关。默认为关。  
5.增加低电平报警时，按KEY1按键关闭蜂鸣器声音。  
6.增加适配8.4V电池供电和电池过压报警（蜂鸣器0.5秒响一次）。  
7.修复不插OLED屏开机，识别不到MPU9250的问题。  
8.增加IMU初始化不通过时，蜂鸣器长鸣笛一声以提示用户。  
9.适配旭日派小车电机定制排线线序。  


## V3.2

1.增加适配旭日派小车控制功能。  
2.修改陀螺仪初始化完成后才开始融合角度，适配旭日派小车的IMU方向问题。  
3.增加低电量报警状态可读取数据和设置车型的功能。  


## V3.1

1.硬件电路改板，硬件版本升级为V2.0。  
2.增加开关按键LED灯功能。  
3.增加X1,X3和X3PLUS小车偏航角校准运动方向的功能。  


## V2.4

1.增加四轮小车速度回读功能。  

## V2.3

1.增加R2/R2L控制舵机方向的同时修改左右两边电机速度的功能。  
2.增加复位状态的功能FUNC_RESET_STATE，包括停车、关灯、蜂鸣器关闭。  
3.增加相关函数的注释。  

## V2.2

1.测试模式采用算法融合四元数和偏航角，不再调用DMP获取数据。  
2.关闭看门狗功能。  
3.增加软件复位MCU串口提示。修改初始化外设的顺序。  

## V2.1

1.修改阿克曼小车默认前轮角度为90度，并增加停车归位舵机的功能。  
2.增加四轮小车控制驱动。  
3.默认测试模式为关闭状态，MAX_PACKET_LENGTH修改为32。  
4.修改阿克曼方向为左正右负。  
5.上传阿克曼的角度为Vy到上层。上层读motion函数得到Vy需乘1000得到原角度。  
6.修改设置车类型，验证位可控制是否写入FLASH。  
7.增加读取当前车类型的功能。  

## V2.0

1.适配小车类型X3 PLUS的底盘和电机。  
2.增加开机串口打印FLASH读取相关数据的提示。  
3.修改陀螺仪方向，修复测试模式下imu测试不准的问题。  
4.修复开机由概率丢失固件的问题。

## V1.8

1.增加CAN控制协议。  
2.增加测试模式。  
3.增加开机检测Flash数据是否已写入。  
4.优化PID参数存到FLASH只存一份数据。  

## V1.7

1.增加四元数解算姿态角的功能。  
2.增加小车类型保存到Flash的功能。  
3.增加阿克曼小车调节前轮舵机角度和设置默认角度的功能。  
4.恢复V1.6.4的PID电机参数。反应更快速。  
5.适配阿克曼小车的电机。  
6.修改按键发送CAN数据的内容。增加CAN接收控制小车功能。
7.开机OLED显示小车类型和固件版本号。  
8.打开看门狗。OLED增加显示编译时间。  
9.增加SBUS航模遥控器控制阿克曼小车。增加航模遥控SWD控制刹车功能。

## V1.6

1.适配V0.4硬件版本。  

## V1.5

1.增加自动发送四路电机编码器当前数据到主控上。  
2.统一坐标轴方向，X轴左右，Y轴前后，Z上下。  
3.增加停车状态的功能，可选刹车停车或自由停车。  
4.增加大麦克纳姆轮车类型数据，适配控制内容。  
5.修改RGB灯条为14颗灯珠，测试并修改所有RGB特效。  
6.增加大架构小麦轮车型。  
7.增加阿克曼小车控制驱动。  
8.修改坐标轴方向，以小车中心出发。X：前正后负；Y：左正右负；Z旋转：左正右负。  

## V1.4

1.增加显示IP地址的功能，FUNC_IP_ADDR。（V1.5删除此功能）  
2.增加功能位FUNC_REPORT_IMU_ATT，发送姿态角数据（Yaw、Roll、Pitch）。  
3.修复SBUS遥控连接不控制时，无法APP控制的问题。  
4.增加OLED开关：ENABLE_OLED。  
5.增加DMA发送串口1数据。  
6.修复PID读写内容。  
7.修改麦克纳姆轮小车类型为0x01。  
8.增加偏航角调节小车前进左右方向的功能。  

## V1.3

1.修改适配V0.3硬件版本。  
2.增加FLASH保存PID参数的功能。  
3.增加机械臂保存中位偏差的功能。  
4.增加长按K1键10秒清空FLASH数据的功能。
5.修改控制方向，X为前后，Y为左右。
6.增加OLED显示IMU偏航角、翻滚角、俯仰角的功能。
7.修改工程名称为rosmaster。  
8.修复SBUS遥控器控制问题。  
9.增加按键控制方向功能。  

## V1.2

1.修改自动发送陀螺仪和加速度计的数据。  
2.修改ICM20948读取数据的频率为102HZ。  
3.增加RGB灯条驱动和炫彩灯效。  
4.修复请求数据的问题。  
5.增加PID调节偏航角的功能。  

## V1.1

1.修改机械臂为6自由度机械臂。  
2.增加INV_MEMS库驱动ICM20948。  
3.增加SBUS驱动程序。  
4.增加CAN总线接收和发送数据的功能，默认波特率为1000Kpbs。  
5.增加SBUS遥控器控制小车运动的功能。  
6.增加软件重启单片机的功能。  
7.增加PID调试功能。  
8.增加开机OLED显示ROSMASTER_X1型号的功能。  
9.关闭DEBUG，打开SBUS接收处理。  

## V 1.0

1.适配新版本V1硬件。  
2.修改电机对应关系，适配麦克纳姆轮运动。  
3.修改电机ID为M1M2M3M4, 避免与ABCD搞混。  
4.增加四路电机的编码器读取脉冲数据, 增加测试速度数据。  
5.增加PID调节速度。  
6.增加麦克纳姆轮控制和反馈速度的功能。  
7.增加自动返回数据的功能。  
8.增加测试电机运动平均速度的功能。  
9.增加OLED每秒刷新显示电压值。  

## V 0.0.3

1.重新修改通讯协议，确定传输规则。  

## V 0.0.2

1.增加ICM20948的驱动。  
2.增加读取版本号的功能。  
3.增加LED指示灯指示板子状态。  
4.增加低电压检测功能。电池电压过低时，蜂鸣器0.1秒响一次。  

## V 0.0.1

1.增加电机驱动。  
2.增加PWM舵机驱动。  
3.增加总线舵机驱动。  
4.增加OLED驱动。  
